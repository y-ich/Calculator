(function(){var CALCULATOR_STATUS,ac2c,activate,angleUnit,c2ac,clearStack,deactivate,display,error,functions,gamma,invTrig,isPortrait,keySound,latestEval,latestUnary,loggamma,memory,parseEval,priority,restoreStatus,reverse,saveStatus,split,stack,tangent,textBuffer,touchEnd,touchStart,trigonometric;try{document.createEvent("TouchEvent");touchStart="touchstart";touchEnd="touchend"}catch(error1){error=error1;touchStart="mousedown";touchEnd="mouseup"}if((typeof AudioContext!=="undefined"&&AudioContext!==null||typeof webkitAudioContext!=="undefined"&&webkitAudioContext!==null)&&!(/\((iPhone|iPad);.*OS (6|7)/.test(navigator.userAgent)&&window.navigator.standalone)){keySound={_context:new(typeof AudioContext!=="undefined"&&AudioContext!==null?AudioContext:webkitAudioContext),play:typeof AudioContext!=="undefined"&&AudioContext!==null?function(){var source;if(keySound._buffer==null){return}source=keySound._context.createBufferSource();source.buffer=keySound._buffer;source.connect(keySound._context.destination);return source.start(0)}:function(){var ref,source;if(keySound._buffer==null){return}source=keySound._context.createBufferSource();source.buffer=keySound._buffer;source.connect(keySound._context.destination);return((ref=source.noteOn)!=null?ref:source.start)(0)}};keySound._context.decodeAudioData(Base64Binary.decodeArrayBuffer("UklGRiQCAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQACAAAAAAAA\nAAD//wIA/f8FAPr/BQB8ASr/yP6Y/uD+YQO0BVsI6gb1AJ355e+Y6fTojfAa+x8J\nvBZlHuchSBsbDVz2iN4tzmLKANh28SANsiY2N1w6FC1tERrxftMYwO+9acrB6KcP\nmTWXTQRTyz4AFpLnu7rHpZCoAMaC9fosnVqibVtkWjymAw7O1ae7nsG0neDrGLlL\nqGvwZzhC6QHewuiTL4GkkeO8dvbWMTFbDmq/Xkg6Bwem2Ji4WbNAwi3hpAkfMZBK\nZU/6PGIYz+0RyNmuY6uYvqTe2QOIKvRDx0tiQskkkALQ4f7I68KzzgrsYQ+yKf45\nnjgDKZYMp+iQyeC1gri1y27s+RHtMFdC5kXsOeohPQi97bnbotRj1grjnPVTCGsW\n2BluF7cOjgNc9ojqLuSn5RjwC/8xDJwXjxthGTwT/gmn//b4ovap9wD6YPpc+T75\nufl6+lD4Af2YBAoRwxt/HfoWgQgP+DXpGuG24TXrG/oqDLgdCSaMIT8RgftY50fe\npNva4pbxMgSBFiokyyaNHk0Qiv/H8pzp+uZF6jj1iQJsDhYVRhVWEYcL5wWH/+L4\nMPSt9CX5Kv/wAxwHlAZ0CScLrwfIAf3/BwD4/wcA+/8AAAMA/f8EAPv/BAD9/wIA\nAQD9/wMA/f8CAAAA//8BAP////8EAPn/BwD7/w=="),function(buffer){return keySound._buffer=buffer},function(){return console.error("decodeAudioData")})}else{keySound={source:new Audio("sounds/click.wav"),play:function(){this.source.play();this.timer=setTimeout(function(_this){return function(){return _this.source.pause()}}(this),1300);return this.play=function(){return setTimeout(function(){return keySound.aux()},0)}},aux:function(){var e;clearTimeout(this.timer);try{if(this.source.readyState>=this.source.HAVE_METADATA){this.source.currentTime=.99}if(this.source.readyState>=this.source.HAVE_FUTURE_DATA){this.source.play();return this.timer=setTimeout(function(_this){return function(){return _this.source.pause()}}(this),300)}}catch(error1){e=error1;return console.log(e.message)}}}}isPortrait=function(){return innerWidth+88<=innerHeight};reverse=function(str){return str.split("").reverse().join("")};split=function(n,str){var i,j,ref,ref1,results;results=[];for(i=j=0,ref=str.length,ref1=n;ref1>0?j<ref:j>ref;i=j+=ref1){results.push(str.slice(i,i+n))}return results};loggamma=function(x){var B,N,i,j,ref,sigma,v,y;B=[1,-1/2,1/6,0,-1/30,0,1/42,0,-1/30,0,5/66,0,-691/2730,0,7/6,0,-3617/510,0,43867/798,0,-174611/330];N=10;v=1;y=x;while(y<N){v*=y;y++}sigma=-Math.log(v)+(y-.5)*Math.log(y)-y+.5*Math.log(2*Math.PI);for(i=j=2,ref=N;j<=ref;i=j+=2){sigma+=B[i]/(i*(i-1)*Math.pow(y,i-1))}return sigma};gamma=function(x){var result;result=Math.exp(loggamma(x));if(Math.floor(x)===x){return Math.floor(result)}else{return result}};trigonometric=function(fn){return function(x){return parseFloat(fn(x*(angleUnit==="Deg"?2*Math.PI/360:1)).toFixed(15))}};invTrig=function(fn){return function(x){return fn(x)/(angleUnit==="Deg"?2*Math.PI/360:1)}};tangent=function(x){var result;result=Math.tan(x);if(Math.abs(result)<15e15){return result}else{return 0/0}};functions={mr:function(){return memory},pi:function(){return Math.PI},e:function(){return Math.E},random:Math.random,percent2number:function(x){return x/100},inverse:function(x){return 1/x},square:function(x){return Math.pow(x,2)},cube:function(x){return Math.pow(x,3)},power:Math.pow,factorial:function(x){return gamma(x+1)},root:function(x){return Math.pow(x,.5)},cuberoot:function(x){return Math.pow(x,1/3)},xthroot:function(x,y){return Math.pow(x,1/y)},log:function(x){return Math.log(x)},log10:function(x){return Math.log(x)/Math.log(10)},log2:function(x){return Math.log(x)/Math.log(2)},sin:trigonometric(Math.sin),cos:trigonometric(Math.cos),tan:trigonometric(tangent),sinh:function(x){return(Math.exp(x)-Math.exp(-x))/2},cosh:function(x){return(Math.exp(x)+Math.exp(-x))/2},tanh:function(x){return parseFloat((functions.sinh(x)/functions.cosh(x)).toFixed(15))},exp:Math.exp,pow2:function(x){return Math.pow(2,x)},pow10:function(x){return Math.pow(10,x)},enotation:function(x,y){return x*Math.pow(10,y)},add:function(x,y){return x+y},sub:function(x,y){return x-y},mul:function(x,y){return x*y},div:function(x,y){return x/y},asin:invTrig(Math.asin),acos:invTrig(Math.acos),atan:invTrig(Math.atan),asinh:function(x){return Math.log(x+Math.sqrt(x*x+1))},acosh:function(x){return Math.log(x+Math.sqrt(x*x-1))},atanh:function(x){return parseFloat((Math.log((1+x)/(1-x))/2).toFixed(15))}};memory=0;angleUnit="Deg";textBuffer={content:"0",val:function(str){if(str!=null){if(str===""||/\..*\./.test(str)){return null}else{this.content=str;this.changed();return this.content}}else{return this.content}},add:function(str){var digits;digits=this.val().replace(/[\-,\.]/g,"").length;if(digits>=display.maxDigits()||/e/.test(display.text())){return}this.added();return this.val(this.content==="0"&&(str==="0"||!/\./.test(str))?str:this.content+str)},toggleSign:function(){return this.val(this.content[0]==="-"?this.content.slice(1):"-"+this.content)},changed:function(){display.bywhom=this;display.update(this.content);saveStatus()},clear:function(){return this.content="0"},added:function(){return ac2c()}};latestEval={content:0,val:function(num){if(num!=null){this.content=num;this.changed();return this.content}else{return this.content}},changed:function(){display.bywhom=this;display.update(this.content);saveStatus()},toggleSign:function(){return this.val(-this.val())}};display={content:"0",bywhom:null,width:function(){if(innerWidth<768){if(isPortrait()){return 280}else{return 406}}else{if(isPortrait()){return 671}else{return 875}}},fontSize:function(){if(innerWidth<768){if(isPortrait()){return"78px"}else{return"50px"}}else{if(isPortrait()){return"182px"}else{return"108px"}}},val:function(){return parseFloat(this.content)},text:function(){return $("#view").text()},maxDigits:function(){if(isPortrait()){return 9}else{return 16}},maxSignificants:function(){if(isPortrait()){return 8}else{return 14}},update:function(numStr){var $view,decimalStr,expStr,exponential,formatted,fracStr,intStr,ref,ref1,ref2,tmp;if(numStr!=null){this.content=numStr;saveStatus()}else{numStr=this.content}$view=$("#view");formatted=this.content.toString();if(/[0-9]/.test(formatted)){if(/e/.test(formatted)){ref=formatted.split("e"),fracStr=ref[0],expStr=ref[1];if(fracStr.replace(".","").length>display.maxSignificants()){formatted=parseFloat(formatted).toExponential(display.maxSignificants())}}else{ref1=formatted.split("."),intStr=ref1[0],decimalStr=ref1[1];if(formatted[0]==="-"){intStr=intStr.slice(1)}if(intStr.length+(decimalStr!=null?decimalStr:"").length<=this.maxDigits()){tmp=reverse(split(3,reverse(intStr)).join(","));if(decimalStr!=null){tmp+="."+decimalStr}formatted=(formatted[0]==="-"?"-":"")+tmp}else if(parseFloat(formatted)===0){tmp=intStr;if(decimalStr!=null){tmp+="."+decimalStr.slice(0,this.maxDigits()-1)}formatted=(formatted[0]==="-"?"-":"")+tmp}else{exponential=parseFloat(formatted).toExponential();ref2=exponential.split("e"),fracStr=ref2[0],expStr=ref2[1];if(fracStr.replace(/[\-\.]/,"").length>=display.maxDigits()){tmp=intStr;if(decimalStr!=null){tmp+="."+decimalStr.slice(0,this.maxDigits()-1)}formatted=(formatted[0]==="-"?"-":"")+tmp}else{formatted=exponential}}}}$view.css("visibility","hidden");$view.text(formatted);$view.css("font-size",display.fontSize());while(!($view[0].offsetWidth<=display.width())){$view.css("font-size",parseInt($view.css("font-size"))-1+"px")}return $view.css("visibility","")}};stack=[];priority={"=":0,"(":0,")":0,add:1,sub:1,mul:2,div:2};latestUnary=null;clearStack=function(){stack=[];return saveStatus()};parseEval=function(operator,operand1){var op,ref,ref1;switch(operator){case"(":stack.push("(");break;case")":latestEval.val(operand1);while(true){op=stack.pop();if(op==null||op==="("){return}latestEval.val(functions[op](stack.pop(),latestEval.val()))}break;case"=":latestUnary=null;latestEval.val(operand1);while(true){op=stack.pop();if(op==null){return}if(op!=="("){latestEval.val(functions[op](stack.pop(),latestEval.val()));if(latestUnary==null){latestUnary=function(operator,operand2){return function(x){return functions[operator](x,operand2)}}(op,operand1)}}}break;default:if(stack.length!==0&&((ref=priority[operator])!=null?ref:3)<=((ref1=priority[stack[stack.length-1]])!=null?ref1:3)){latestEval.val(functions[stack.pop()](stack.pop(),operand1));stack.push(latestEval.val(),operator)}else{stack.push(operand1,operator)}}saveStatus()};CALCULATOR_STATUS="calculator-status";saveStatus=function(){localStorage[CALCULATOR_STATUS]=JSON.stringify({memory:memory,textBuffer:textBuffer.val(),latestEval:latestEval.val(),display:display.content,stack:stack,angleUnit:angleUnit,clear:$("#clear").data("role"),mr:$("#mr .active").length>0})};restoreStatus=function(){var $angleKey,status;if(localStorage[CALCULATOR_STATUS]!=null){status=JSON.parse(localStorage[CALCULATOR_STATUS]);if(status.memory!=null){memory=status.memory}if(status.textBuffer!=null){textBuffer.content=status.textBuffer}if(status.latestEval!=null){latestEval.content=status.latestEval}if(status.display!=null){display.content=status.display;display.update()}if(status.stack!=null){stack=status.stack;if(stack.length>0){activate($('.binary[data-role="'+stack[stack.length-1]+'"]'))}}if(status.angleUnit!=null){angleUnit=status.angleUnit}$angleKey=$("#angle_key");if(angleUnit==="Rad"){$angleKey.html($angleKey.html().replace("Rad","Deg"))}else{$angleKey.html($angleKey.html().replace("Deg","Rad"))}$("#angle").text(angleUnit);if(status.mr){activate($("#mr"))}switch(status.clear){case"clear":ac2c();break;case"allclear":c2ac()}}};$(document.body).bind("touchmove",function(event){return event.preventDefault()});$(".key").each(function(){var $this;$this=$(this);if($(this).data("role")==null){return $this.data("role",$this.text())}});$("#clear").bind(touchEnd,function(event){if($(this).data("role")==="allclear"){latestUnary=null;clearStack();deactivate($(".binary"))}else{activate($('.binary[data-role="'+stack[stack.length-1]+'"]'))}textBuffer.clear();latestEval.val(0);return c2ac()});$("#pi").bind(touchEnd,function(){return ac2c()});$(".number").bind(touchEnd,function(){return textBuffer.add($(this).data("role").toString())});$(".number, #pi").bind(touchEnd,function(){return deactivate($(".binary"))});$("#period").bind(touchEnd,function(){if(!/\./.test(textBuffer.val())){return textBuffer.add($(this).data("role"))}});$("#plusminus").bind(touchEnd,function(){if(display.bywhom===textBuffer){return textBuffer.toggleSign()}else{return display.update(-display.val())}});$("#mc").bind(touchEnd,function(){memory=0;deactivate($("#mr"));return saveStatus()});$("#mplus").bind(touchEnd,function(){textBuffer.clear();memory+=display.val();activate($("#mr"));return saveStatus()});$("#mminus").bind(touchEnd,function(){textBuffer.clear();memory-=display.val();activate($("#mr"));return saveStatus()});$(".nofix").bind(touchEnd,function(){display.bywhom="nofix";display.update(functions[$(this).data("role")]().toString());return textBuffer.clear()});$(".unary").bind(touchEnd,function(){latestUnary=functions[$(this).data("role")];display.bywhom="unary";display.update(latestUnary(display.val()).toString());return textBuffer.clear()});$(".binary").bind(touchEnd,function(){deactivate($(".binary"));return activate($(this))});$(".binary, #parright").bind(touchEnd,function(){parseEval($(this).data("role"),display.val());return textBuffer.clear()});$("#parleft").bind(touchEnd,function(){parseEval($(this).data("role"));return textBuffer.clear()});$("#equal_key").bind(touchEnd,function(){if(stack.length!==0){parseEval($(this).data("role"),display.val());return textBuffer.clear()}else if(latestUnary!=null){display.bywhom="equal_key";return display.update(latestUnary(display.val()).toString())}});$("#angle_key").bind(touchEnd,function(){var $this;$this=$(this);if(angleUnit==="Deg"){angleUnit="Rad";$this.html($this.html().replace("Rad","Deg"))}else{angleUnit="Deg";$this.html($this.html().replace("Deg","Rad"))}$("#angle").text(angleUnit);return saveStatus()});$("#second").bind(touchEnd,function(){if($(this).data("status")==="off"){$(this).data("status","on");$(this).css("color","#de8235");return $(".key.double").each(function(){var $this,fnname;$this=$(this);switch($this.data("role")){case"log":$this.data("role","log2");return $this.html($this.html().replace("ln","log<sub>2</sub>"));case"exp":$this.data("role","pow2");return $this.html($this.html().replace("e","2"));default:fnname=$this.data("role");$this.data("role","a"+fnname);return $this.html($this.html().replace(fnname,fnname+"<sup>-1</sup>"))}})}else{$(this).data("status","off");$(this).css("color","");return $(".key.double").each(function(){var $this,fnname;$this=$(this);switch($this.data("role")){case"log2":$this.data("role","log");return $this.html($this.html().replace("log<sub>2</sub>","ln"));case"pow2":$this.data("role","exp");return $this.html($this.html().replace("2","e"));default:fnname=$this.data("role");$this.data("role",fnname.slice(1));return $this.html($this.html().replace("<sup>-1</sup>",""))}})}});$(".key").bind(touchStart,function(){return keySound.play()});$(window).bind("orientationchange",function(){return display.update()});ac2c=function(){$("#clear").data("role","clear");$("#clear").html($("#clear").html().replace(/^AC/,"C"));return saveStatus()};c2ac=function(){$("#clear").data("role","allclear");$("#clear").html($("#clear").html().replace(/^C/,"AC"));return saveStatus()};activate=function($elem){var active;active=$elem.children(".active");if(active==null||active.length===0){return $elem.append($('<div class="active">'))}};deactivate=function($elem){return $elem.children(".active").remove()};applicationCache.addEventListener("checking",function(){return console.log("Checking update...")});applicationCache.addEventListener("noupdate",function(){return console.log("No update.")});applicationCache.addEventListener("downloading",function(){return console.log("Downloading newer version...")});applicationCache.addEventListener("progress",function(){return console.log(".")});applicationCache.addEventListener("cached",function(){return console.log("Cached.")});applicationCache.addEventListener("updateready",function(){return console.log("Updateready.")});applicationCache.addEventListener("error",function(){return console.log("applicationCache error")});restoreStatus()}).call(this);